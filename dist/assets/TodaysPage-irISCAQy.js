import{_ as yt,r as l,C as lt,a as ht,d as Dt,c as Z,I as Ct,b as wt,e as Tt,f as xt,g as St,h as bt,i as kt,s as c,j as g,k as It,o as tt,N as A,l as Pt,u as Nt,m as Vt,n as et,p as At,q as I,t as ot,w as n,v as t,x as p,y as Ft,z as a,A as Mt,B as zt,D as Et,E as st,F as Rt,G as Bt}from"./index-Bt-f6BQ3.js";import{_ as $t}from"./right-arrow-3JDP4J1r.js";l("");lt.register(...ht);let Y=!1;const q=Dt({name:"PieChartView",components:{IonContent:Ct,IonIcon:wt,IonCol:Tt,IonRow:xt,IonItem:St,IonList:bt,IonGrid:kt},data(){return{moving_color:"",stopped_color:"",offline_color:"",idle_color:""}},async created(){const o=await c.get("movingcolor"),e=await c.get("stoppedcolor"),w=await c.get("idlecolor"),D=await c.get("offlinecolor");this.moving_color=o||g.Veh_color.Key_Active_Color,this.stopped_color=e||g.Veh_color.key_Stopped_Color,this.offline_color=D||g.Veh_color.Key_Offline_Color,this.idle_color=w||g.Veh_color.Key_Idle_Color},setup(){let o=0;const e=l(!0),w=l(!1);let D=null;const M=l(!0),X=async()=>{const s=await A.getStatus();e.value=s.connected},P=()=>{A.addListener("networkStatusChange",s=>{e.value=s.connected,s.connected&&(w.value=!0,D&&clearTimeout(D),D=setTimeout(()=>{w.value=!1},1e4))})};function u(s){const C={year:"numeric",month:"short",day:"2-digit"};return new Intl.DateTimeFormat("en-US",C).format(s)}function T(s){const C=String(s.getDate()).padStart(2,"0"),f=String(s.getMonth()+1).padStart(2,"0"),v=s.getFullYear();return"".concat(C,"-").concat(f,"-").concat(v)}const d=l(null),_=l(null),N=l(null);if(d.value!==null)_.value=u(d.value),N.value=T(d.value);else{const s=new Date;_.value=u(s),N.value=T(s)}async function V(){const s=await c.get(g.storageValue.Key_Todays);s&&s.length>0&&(y.value.t_av=s[0].t_av,y.value.t_sv=s[0].t_sv,y.value.t_ov=s[0].t_ov,E.value=s[0].t_d,R.value=s[0].a_d_pav,B.value=s[0].t_dd,$.value=s[0].a_dd_pav,K.value=s[0].t_vc,O.value=s[0].a_vc_pav,G.value=s[0].t_f,j.value=s[0].a_f_pav,U())}async function S(){console.log("calledAPi");const s=N.value,C={req_period:"5",is_smry:"1",fdate:s,rpt_type:"1",tdate:s};zt.create({message:"Loading...",backdropDismiss:!0}).then(f=>{f.present(),Et(g.CONT.Mobile_Contro,g.CMD.Req_Dash_All,C).then(async v=>{const r=v.data;if(v.status===200){const i=r.arr_data;console.log("Received data");const L=new Date;if(await c.set("APIcalledTodaysDate",L),i&&i.length>0)return console.log("displayerror",i[0]),await c.set(g.storageValue.Key_Todays,i).then(()=>{y.value.t_av=i[0].t_av,y.value.t_sv=i[0].t_sv,y.value.t_ov=i[0].t_ov,E.value=i[0].t_d,R.value=i[0].a_d_pav,B.value=i[0].t_dd,$.value=i[0].a_dd_pav,K.value=i[0].t_vc,O.value=i[0].a_vc_pav,G.value=i[0].t_f,j.value=i[0].a_f_pav,U()})}else return v.status===401?(this.toastMessage=r.message,Promise.reject(new Error(r.message))):(console.error("Empty response data"),Promise.reject(new Error("Empty response data")))}).catch(v=>{console.error("Error:",v)}).finally(()=>f.dismiss())}).catch(f=>{console.error("Error creating loading:",f)})}const z=l(null);let b=null;const y=l({t_av:0,t_sv:0,t_ov:0,total_dis:0,dist_per:0,moving_dis:0,moving_per:0,violation_count:0,violation_per:0,fuel_cons:0,fuel_per:0}),it=l(It),E=l(0),R=l(0),B=l(0),$=l(0),K=l(0),O=l(0),G=l(0),j=l(0),rt=()=>{console.log(_.value),st.push({name:"Periodtoday",params:{currentDate:_.value}})},ct=()=>{st.push({name:"grouptoday",params:{currentDate:_.value}})},U=()=>{h.value.moving=y.value.t_av,h.value.stopped=y.value.t_sv,h.value.offline=y.value.t_ov,b&&b.destroy(),W()},h=l({moving:0,stopped:0,offline:0}),W=async()=>{await Rt();const s=await c.get("movingcolor"),C=await c.get("stoppedcolor");await c.get("idlecolor");const f=await c.get("offlinecolor"),v=s||g.Veh_color.Key_Active_Color,r=C||g.Veh_color.key_Stopped_Color,i=f||g.Veh_color.Key_Offline_Color;if(b&&b.destroy(),z.value){const L=z.value.getContext("2d"),dt=Number(h.value.moving)+Number(h.value.stopped)+Number(h.value.offline);b=new lt(L,{type:"doughnut",data:{datasets:[{label:"Today Status",data:[h.value.moving,h.value.stopped,h.value.offline],backgroundColor:[v,r,i],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"65%",plugins:{legend:{display:!1},datalabels:{display:!1}},tooltip:{callbacks:{label:function(k){let x=k.label||"";return x&&(x+=": "),k.raw!==null&&(x+=k.raw),x}}},datalabels:{display:!1}},plugins:[{id:"centerText",beforeDraw:k=>{const x=k.width,F=k.height,m=k.ctx;m.restore();const ut=(F/150).toFixed(2);m.font="".concat(ut,"em sans-serif"),m.textBaseline="middle",m.fillStyle="#000";const H="Total",J="Count",Q=dt.toString(),_t=Math.round((x-m.measureText(H).width)/2),vt=Math.round((x-m.measureText(J).width)/2),pt=Math.round((x-m.measureText(Q).width)/2),ft=F/2-20,mt=F/2,gt=F/2+20;m.fillText(H,_t,ft),m.fillText(J,vt,mt),m.fillText(Q,pt,gt),m.save()}}]})}};return tt(()=>{A.removeAllListeners(),D&&clearTimeout(D)}),Pt(async()=>{const C=(await c.get("login_data")).isFuel;M.value=C===1,Nt(9999,async()=>{console.log("displayionview","today");const r=new Date().getTime();r-o<2e3?navigator.app.exitApp():(o=r,await Bt("Press again to exit the app"))}),await X(),P();const f=await c.get("savedTodaysDate");if(f)d.value=f;else{const r=new Date;d.value=r}if(console.log("Selected date11:",d.value),d.value!==null){const r=new Date(d.value);_.value=u(r),N.value=T(r)}const v=await c.get("APIcalledTodaysDate");if(v!==null){const r=Vt(v);console.log("isMinDoneOrNot",r),r?(await A.getStatus()).connected?(V(),S()):(et(),V()):Y?S():V()}else(await A.getStatus()).connected?(V(),S()):et();W()}),tt(()=>{b&&b.destroy()}),{formattedCurrentDate:_,receivedDate:d,pieChartRef:z,todaysData:y,Distance_tot:E,Distance_per:R,movingDuration1:B,movingDuration2:$,violation1:K,violation2:O,fuelCons1:G,fuelCons2:j,iconName:it,chartData:h,clickForDatePage:rt,openGroup:ct,IsFuelEnable:M,isConnected:e,showReconnectedMessage:w}},async beforeRouteEnter(o,e,w){Y=!1,e.name==="Periodtoday"&&await c.get("isChangeDateToday")&&(Y=!0),w()}}),at=()=>{At(o=>({"6bee824c":o.moving_color,"0b59a3e0":o.idle_color,"2a2534c9":o.stopped_color,"75b86f42":o.offline_color}))},nt=q.setup;q.setup=nt?(o,e)=>(at(),nt(o,e)):at;const Kt={class:"month-below1"},Ot={class:"custom-item"},Gt={id:"chart-container"},jt={ref:"pieChartRef"},Lt={class:"item-content"},Yt={class:"status"},qt={class:"status-value"},Xt={class:"status-item stopped"},Ut={class:"status-value"},Wt={class:"status-item offline"},Ht={class:"status-value"},Jt={class:"text-container"},Qt={style:{display:"flex"}},Zt={class:"text2"},te={class:"text3"},ee={class:"text-container"},oe={style:{display:"flex"}},se={class:"text2"},ae={class:"text3"},ne={class:"text-container"},le={style:{display:"flex"}},ie={class:"text2"},re={class:"text3"},ce={class:"text-container"},de={style:{display:"flex"}},ue={class:"text2"},_e={class:"text3"};function ve(o,e,w,D,M,X){const P=I("ion-icon"),u=I("ion-col"),T=I("ion-row"),d=I("ion-grid"),_=I("ion-item"),N=I("ion-list"),V=I("ion-content");return ot(),Z(V,null,{default:n(()=>[t("div",Kt,[t("div",{class:"month-total date",onClick:e[0]||(e[0]=(...S)=>o.clickForDatePage&&o.clickForDatePage(...S))},p(o.formattedCurrentDate),1),t("div",{class:"right-group",onClick:e[1]||(e[1]=(...S)=>o.openGroup&&o.openGroup(...S))},e[2]||(e[2]=[t("div",{class:"month-total"},"Group",-1),t("img",{src:$t,alt:"event icon",class:"icon-arrow"},null,-1)]))]),t("div",Ot,[t("div",Gt,[t("canvas",jt,null,512)]),t("div",Lt,[t("div",Yt,[t("div",{style:Ft({color:o.moving_color}),class:"status-item"},[e[3]||(e[3]=t("span",{class:"status-label"},"Active",-1)),t("span",qt,p(o.chartData.moving),1)],4),t("div",Xt,[e[4]||(e[4]=t("span",{class:"status-label"},"Stopped",-1)),t("span",Ut,p(o.chartData.stopped),1)]),t("div",Wt,[e[5]||(e[5]=t("span",{class:"status-label"},"Offline",-1)),t("span",Ht,p(o.chartData.offline),1)])])])]),e[14]||(e[14]=t("div",{class:"month-below"},[t("div",{class:"month-total"},"Fleet Total - "),t("div",{class:"today-total"},"(Per Vehicle Average)")],-1)),a(N,null,{default:n(()=>[a(_,null,{default:n(()=>[a(d,null,{default:n(()=>[a(T,{style:{"align-items":"center"}},{default:n(()=>[a(u,{size:"auto"},{default:n(()=>[a(P,{icon:o.iconName,style:{"font-size":"30px"}},null,8,["icon"])]),_:1}),a(u,null,{default:n(()=>[t("div",Jt,[e[7]||(e[7]=t("p",{class:"text1"},"Distance travelled",-1)),t("div",Qt,[t("p",Zt,p(o.Distance_tot),1),e[6]||(e[6]=t("p",{class:"text2"},"-",-1)),t("p",te,"("+p(o.Distance_per)+") ",1)])])]),_:1})]),_:1})]),_:1})]),_:1}),a(_,null,{default:n(()=>[a(d,null,{default:n(()=>[a(T,{style:{"align-items":"center"}},{default:n(()=>[a(u,{size:"auto"},{default:n(()=>[a(P,{icon:o.iconName,style:{"font-size":"30px"}},null,8,["icon"])]),_:1}),a(u,null,{default:n(()=>[t("div",ee,[e[9]||(e[9]=t("p",{class:"text1"},"Moving Duration",-1)),t("div",oe,[t("p",se,p(o.movingDuration1),1),e[8]||(e[8]=t("p",{class:"text2"},"-",-1)),t("p",ae,"("+p(o.movingDuration2)+")",1)])])]),_:1})]),_:1})]),_:1})]),_:1}),a(_,null,{default:n(()=>[a(d,null,{default:n(()=>[a(T,{style:{"align-items":"center"}},{default:n(()=>[a(u,{size:"auto"},{default:n(()=>[a(P,{icon:o.iconName,style:{"font-size":"30px"}},null,8,["icon"])]),_:1}),a(u,null,{default:n(()=>[t("div",ne,[e[11]||(e[11]=t("p",{class:"text1"},"Violation Count",-1)),t("div",le,[t("p",ie,p(o.violation1),1),e[10]||(e[10]=t("p",{class:"text2"},"-",-1)),t("p",re,"("+p(o.violation2)+")",1)])])]),_:1})]),_:1})]),_:1})]),_:1}),o.IsFuelEnable?(ot(),Z(_,{key:0},{default:n(()=>[a(d,null,{default:n(()=>[a(T,{style:{"align-items":"center"}},{default:n(()=>[a(u,{size:"auto"},{default:n(()=>[a(P,{icon:o.iconName,style:{"font-size":"30px"}},null,8,["icon"])]),_:1}),a(u,null,{default:n(()=>[t("div",ce,[e[13]||(e[13]=t("p",{class:"text1"},"Fuel Consumed",-1)),t("div",de,[t("p",ue,p(o.fuelCons1),1),e[12]||(e[12]=t("p",{class:"text2"},"-",-1)),t("p",_e,"("+p(o.fuelCons2)+")",1)])])]),_:1})]),_:1})]),_:1})]),_:1})):Mt("",!0)]),_:1})]),_:1})}const me=yt(q,[["render",ve],["__scopeId","data-v-1e525d0b"]]);export{me as default};
