import{_ as yt,C as lt,r as ht,d as Dt,c as Z,I as Ct,a as wt,b as St,e as Tt,f as xt,g as bt,h as It,s as m,i as g,j as i,k as kt,o as tt,N as A,l as Nt,u as Pt,m as Vt,n as et,p as At,q as k,t as ot,w as n,v as t,x as v,y as Ft,z as a,A as Mt,B as zt,D as Et,E as st,F as Rt}from"./index-CfKYJtiF.js";import{_ as Bt}from"./right-arrow-3JDP4J1r.js";lt.register(...ht);let Y=!1;const q=Dt({name:"PieChartView",components:{IonContent:Ct,IonIcon:wt,IonCol:St,IonRow:Tt,IonItem:xt,IonList:bt,IonGrid:It},data(){return{moving_color:"",stopped_color:"",offline_color:"",idle_color:""}},async created(){const o=await m.get("movingcolor"),e=await m.get("stoppedcolor"),w=await m.get("idlecolor"),D=await m.get("offlinecolor");this.moving_color=o||g.Veh_color.Key_Active_Color,this.stopped_color=e||g.Veh_color.key_Stopped_Color,this.offline_color=D||g.Veh_color.Key_Offline_Color,this.idle_color=w||g.Veh_color.Key_Idle_Color},setup(){let o=0;const e=i(!0),w=i(!1);let D=null;const M=i(!0),X=async()=>{const s=await A.getStatus();e.value=s.connected},N=()=>{A.addListener("networkStatusChange",s=>{e.value=s.connected,s.connected&&(w.value=!0,D&&clearTimeout(D),D=setTimeout(()=>{w.value=!1},1e4))})};function d(s){const C={year:"numeric",month:"short",day:"2-digit"};return new Intl.DateTimeFormat("en-US",C).format(s)}function S(s){const C=String(s.getDate()).padStart(2,"0"),p=String(s.getMonth()+1).padStart(2,"0"),_=s.getFullYear();return"".concat(C,"-").concat(p,"-").concat(_)}const c=i(null),u=i(null),P=i(null);if(c.value!==null)u.value=d(c.value),P.value=S(c.value);else{const s=new Date;u.value=d(s),P.value=S(s)}async function V(){const s=await m.get(g.storageValue.Key_Todays);s&&s.length>0&&(y.value.t_av=s[0].t_av,y.value.t_sv=s[0].t_sv,y.value.t_ov=s[0].t_ov,E.value=s[0].t_d,R.value=s[0].a_d_pav,B.value=s[0].t_dd,$.value=s[0].a_dd_pav,K.value=s[0].t_vc,O.value=s[0].a_vc_pav,j.value=s[0].t_f,G.value=s[0].a_f_pav,U())}async function x(){const s=P.value,C={req_period:"5",is_smry:"1",fdate:s,rpt_type:"1",tdate:s};zt.create({message:"Loading...",backdropDismiss:!0}).then(p=>{p.present(),Et(g.CONT.Mobile_Contro,g.CMD.Req_Dash_All,C).then(_=>{const r=_.data;if(_.status===200){const l=r.arr_data;console.log("Received data");const L=new Date;if(localStorage.setItem("APIcalledTodaysDate",L),l&&l.length>0)return console.log("displayerror",l[0]),m.set(g.storageValue.Key_Todays,l).then(()=>{y.value.t_av=l[0].t_av,y.value.t_sv=l[0].t_sv,y.value.t_ov=l[0].t_ov,E.value=l[0].t_d,R.value=l[0].a_d_pav,B.value=l[0].t_dd,$.value=l[0].a_dd_pav,K.value=l[0].t_vc,O.value=l[0].a_vc_pav,j.value=l[0].t_f,G.value=l[0].a_f_pav,U()})}else return _.status===401?(this.toastMessage=r.message,Promise.reject(new Error(r.message))):(console.error("Empty response data"),Promise.reject(new Error("Empty response data")))}).catch(_=>{console.error("Error:",_)}).finally(()=>p.dismiss())}).catch(p=>{console.error("Error creating loading:",p)})}const z=i(null);let b=null;const y=i({t_av:0,t_sv:0,t_ov:0,total_dis:0,dist_per:0,moving_dis:0,moving_per:0,violation_count:0,violation_per:0,fuel_cons:0,fuel_per:0}),it=i(kt),E=i(0),R=i(0),B=i(0),$=i(0),K=i(0),O=i(0),j=i(0),G=i(0),rt=()=>{console.log(u.value),st.push({name:"Periodtoday",params:{currentDate:u.value}})},ct=()=>{st.push({name:"grouptoday",params:{currentDate:u.value}})},U=()=>{h.value.moving=y.value.t_av,h.value.stopped=y.value.t_sv,h.value.offline=y.value.t_ov,b&&b.destroy(),W()},h=i({moving:0,stopped:0,offline:0}),W=async()=>{const s=await m.get("movingcolor"),C=await m.get("stoppedcolor");await m.get("idlecolor");const p=await m.get("offlinecolor"),_=s||g.Veh_color.Key_Active_Color,r=C||g.Veh_color.key_Stopped_Color,l=p||g.Veh_color.Key_Offline_Color;if(b&&b.destroy(),z.value){const L=z.value.getContext("2d"),dt=Number(h.value.moving)+Number(h.value.stopped)+Number(h.value.offline);b=new lt(L,{type:"doughnut",data:{datasets:[{label:"Today Status",data:[h.value.moving,h.value.stopped,h.value.offline],backgroundColor:[_,r,l],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"65%",plugins:{legend:{display:!1},datalabels:{display:!1}},tooltip:{callbacks:{label:function(I){let T=I.label||"";return T&&(T+=": "),I.raw!==null&&(T+=I.raw),T}}},datalabels:{display:!1}},plugins:[{id:"centerText",beforeDraw:I=>{const T=I.width,F=I.height,f=I.ctx;f.restore();const ut=(F/150).toFixed(2);f.font="".concat(ut,"em sans-serif"),f.textBaseline="middle",f.fillStyle="#000";const H="Total",J="Count",Q=dt.toString(),_t=Math.round((T-f.measureText(H).width)/2),vt=Math.round((T-f.measureText(J).width)/2),pt=Math.round((T-f.measureText(Q).width)/2),ft=F/2-20,mt=F/2,gt=F/2+20;f.fillText(H,_t,ft),f.fillText(J,vt,mt),f.fillText(Q,pt,gt),f.save()}}]})}};return tt(()=>{A.removeAllListeners(),D&&clearTimeout(D)}),Nt(async()=>{const C=(await m.get("login_data")).isFuel;M.value=C===1,Pt(9999,async()=>{console.log("displayionview","today");const r=new Date().getTime();r-o<2e3?navigator.app.exitApp():(o=r,await Rt("Press again to exit the app"))}),await X(),N();const p=localStorage.getItem("savedTodaysDate");if(p)c.value=p;else{const r=new Date;c.value=r}if(console.log("Selected date:",c.value),c.value!==null){const r=new Date(c.value);u.value=d(r),P.value=S(r)}const _=localStorage.getItem("APIcalledTodaysDate");if(_!==null){const r=Vt(_);console.log("isMinDoneOrNot",r),r?(await A.getStatus()).connected?(V(),x()):(et(),V()):Y?x():V()}else(await A.getStatus()).connected?(V(),x()):et();W()}),tt(()=>{b&&b.destroy()}),{formattedCurrentDate:u,receivedDate:c,pieChartRef:z,todaysData:y,Distance_tot:E,Distance_per:R,movingDuration1:B,movingDuration2:$,violation1:K,violation2:O,fuelCons1:j,fuelCons2:G,iconName:it,chartData:h,clickForDatePage:rt,openGroup:ct,IsFuelEnable:M,isConnected:e,showReconnectedMessage:w}},beforeRouteEnter(o,e,w){Y=!1,e.name==="Periodtoday"&&localStorage.getItem("isChangeDateToday")==="true"&&(Y=!0),w()}}),at=()=>{At(o=>({"4b7ded5c":o.moving_color,"3426ea3c":o.idle_color,"515452f2":o.stopped_color,"72546a1d":o.offline_color}))},nt=q.setup;q.setup=nt?(o,e)=>(at(),nt(o,e)):at;const $t={class:"month-below1"},Kt={class:"custom-item"},Ot={id:"chart-container"},jt={ref:"pieChartRef"},Gt={class:"item-content"},Lt={class:"status"},Yt={class:"status-value"},qt={class:"status-item stopped"},Xt={class:"status-value"},Ut={class:"status-item offline"},Wt={class:"status-value"},Ht={class:"text-container"},Jt={style:{display:"flex"}},Qt={class:"text2"},Zt={class:"text3"},te={class:"text-container"},ee={style:{display:"flex"}},oe={class:"text2"},se={class:"text3"},ae={class:"text-container"},ne={style:{display:"flex"}},le={class:"text2"},ie={class:"text3"},re={class:"text-container"},ce={style:{display:"flex"}},de={class:"text2"},ue={class:"text3"};function _e(o,e,w,D,M,X){const N=k("ion-icon"),d=k("ion-col"),S=k("ion-row"),c=k("ion-grid"),u=k("ion-item"),P=k("ion-list"),V=k("ion-content");return ot(),Z(V,null,{default:n(()=>[t("div",$t,[t("div",{class:"month-total date",onClick:e[0]||(e[0]=(...x)=>o.clickForDatePage&&o.clickForDatePage(...x))},v(o.formattedCurrentDate),1),t("div",{class:"right-group",onClick:e[1]||(e[1]=(...x)=>o.openGroup&&o.openGroup(...x))},e[2]||(e[2]=[t("div",{class:"month-total"},"Group",-1),t("img",{src:Bt,alt:"event icon",class:"icon-arrow"},null,-1)]))]),t("div",Kt,[t("div",Ot,[t("canvas",jt,null,512)]),t("div",Gt,[t("div",Lt,[t("div",{style:Ft({color:o.moving_color}),class:"status-item"},[e[3]||(e[3]=t("span",{class:"status-label"},"Active",-1)),t("span",Yt,v(o.chartData.moving),1)],4),t("div",qt,[e[4]||(e[4]=t("span",{class:"status-label"},"Stopped",-1)),t("span",Xt,v(o.chartData.stopped),1)]),t("div",Ut,[e[5]||(e[5]=t("span",{class:"status-label"},"Offline",-1)),t("span",Wt,v(o.chartData.offline),1)])])])]),e[14]||(e[14]=t("div",{class:"month-below"},[t("div",{class:"month-total"},"Fleet Total - "),t("div",{class:"today-total"},"(Per Vehicle Average)")],-1)),a(P,null,{default:n(()=>[a(u,null,{default:n(()=>[a(c,null,{default:n(()=>[a(S,{style:{"align-items":"center"}},{default:n(()=>[a(d,{size:"auto"},{default:n(()=>[a(N,{icon:o.iconName,style:{"font-size":"30px"}},null,8,["icon"])]),_:1}),a(d,null,{default:n(()=>[t("div",Ht,[e[7]||(e[7]=t("p",{class:"text1"},"Distance travelled",-1)),t("div",Jt,[t("p",Qt,v(o.Distance_tot),1),e[6]||(e[6]=t("p",{class:"text2"},"-",-1)),t("p",Zt,"("+v(o.Distance_per)+") ",1)])])]),_:1})]),_:1})]),_:1})]),_:1}),a(u,null,{default:n(()=>[a(c,null,{default:n(()=>[a(S,{style:{"align-items":"center"}},{default:n(()=>[a(d,{size:"auto"},{default:n(()=>[a(N,{icon:o.iconName,style:{"font-size":"30px"}},null,8,["icon"])]),_:1}),a(d,null,{default:n(()=>[t("div",te,[e[9]||(e[9]=t("p",{class:"text1"},"Moving Duration",-1)),t("div",ee,[t("p",oe,v(o.movingDuration1),1),e[8]||(e[8]=t("p",{class:"text2"},"-",-1)),t("p",se,"("+v(o.movingDuration2)+")",1)])])]),_:1})]),_:1})]),_:1})]),_:1}),a(u,null,{default:n(()=>[a(c,null,{default:n(()=>[a(S,{style:{"align-items":"center"}},{default:n(()=>[a(d,{size:"auto"},{default:n(()=>[a(N,{icon:o.iconName,style:{"font-size":"30px"}},null,8,["icon"])]),_:1}),a(d,null,{default:n(()=>[t("div",ae,[e[11]||(e[11]=t("p",{class:"text1"},"Violation Count",-1)),t("div",ne,[t("p",le,v(o.violation1),1),e[10]||(e[10]=t("p",{class:"text2"},"-",-1)),t("p",ie,"("+v(o.violation2)+")",1)])])]),_:1})]),_:1})]),_:1})]),_:1}),o.IsFuelEnable?(ot(),Z(u,{key:0},{default:n(()=>[a(c,null,{default:n(()=>[a(S,{style:{"align-items":"center"}},{default:n(()=>[a(d,{size:"auto"},{default:n(()=>[a(N,{icon:o.iconName,style:{"font-size":"30px"}},null,8,["icon"])]),_:1}),a(d,null,{default:n(()=>[t("div",re,[e[13]||(e[13]=t("p",{class:"text1"},"Fuel Consumed",-1)),t("div",ce,[t("p",de,v(o.fuelCons1),1),e[12]||(e[12]=t("p",{class:"text2"},"-",-1)),t("p",ue,"("+v(o.fuelCons2)+")",1)])])]),_:1})]),_:1})]),_:1})]),_:1})):Mt("",!0)]),_:1})]),_:1})}const fe=yt(q,[["render",_e],["__scopeId","data-v-096c8f5e"]]);export{fe as default};
